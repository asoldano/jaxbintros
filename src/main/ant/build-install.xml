<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<project>
  
  <!-- ================================================================== -->
  <!-- Setup                                                              -->
  <!-- ================================================================== -->
  
  <property name="common.dir" value="${basedir}"/>
  <property name="common.etc.dir" value="${common.dir}/src/main/etc"/>
  <property name="common.target.dir" value="${common.dir}/target"/>
  
  <!-- ================================================================== -->
  <!-- Initialization                                                     -->
  <!-- ================================================================== -->
  
  <target name="init">
    <property name="repository.id" value="${version.id}"/>
    <echo message="version.id=${version.id}"/>
    <echo message="repository.id=${repository.id}"/>
    <echo message="jboss.local.repository=${jboss.local.repository}"/>
  </target>
  
  <target name="check-properties" depends="init">
    <available property="jboss.local.repository.available" type="dir" file="${jboss.local.repository}"/>
    <fail message="Cannot find directory ${jboss.local.repository}. Did you copy profiles-example.xml?" unless="jboss.local.repository.available"/>
  </target>
  
  <!-- ================================================================== -->
  <!-- Installation                                                       -->
  <!-- ================================================================== -->
  
  <!-- Install to jboss.local.repository -->
  <target name="install" depends="check-properties" description="Install to jboss.local.repository">
    
    <!-- Check if the target jar is available -->
    <available property="jboss-jaxb-intros.jar.available" file="${common.target.dir}/jboss-jaxb-intros-${version.id}.jar"/>
    <fail message="Cannot find jboss-jaxb-intros-${version.id}.jar. Did you run 'mvn package'?" unless="jboss-jaxb-intros.jar.available"/>
    
    <!-- Check if the source jar is available -->
    <available property="jboss-jaxb-intros.sources.jar.available" file="${common.target.dir}/jboss-jaxb-intros-${version.id}-sources.jar"/>
    <fail message="Cannot find jboss-jaxb-intros-${version.id}-sources.jar. Did you run 'mvn source:jar'?" unless="jboss-jaxb-intros.sources.jar.available"/>
    
    <!-- jboss/jboss-jaxb-intros -->
    <property name="jboss.repository.dir" value="${jboss.local.repository}/jboss/jboss-jaxb-intros/${repository.id}"/>
    <mkdir dir="${jboss.repository.dir}/lib"/>
    <copy file="${common.target.dir}/jboss-jaxb-intros-${version.id}.jar" tofile="${jboss.repository.dir}//lib/jboss-jaxb-intros.jar" overwrite="true"/>
    <copy file="${common.target.dir}/jboss-jaxb-intros-${version.id}-sources.jar" tofile="${jboss.repository.dir}/lib/jboss-jaxb-intros-src.jar" overwrite="true"/>
    <copy file="${common.target.dir}/etc/component-info.xml" tofile="${jboss.repository.dir}/component-info.xml" overwrite="true"/>
  </target>
  
</project>
